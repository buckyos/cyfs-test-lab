"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TaskMain = void 0;
const base_1 = require("../../base");
const path = __importStar(require("path"));
const stackTool_1 = require("../../taskTools/cyfs_stack_tunnel/stackTool");
const cyfs = __importStar(require("../../taskTools/cyfs_stack_tunnel/cyfs_node"));
const fs = __importStar(require("fs-extra"));
async function test_file(_interface, DMC_Download, DMC_Upload, stack_download, stack_upload, fileSize, timeout) {
    let dec_id = cyfs.ObjectId.from_base_58("9tGpLNnab9uVtjeaK4bM59QKSkLEGWow1pJq6hjjK9MM").unwrap();
    let download_path = await DMC_Download.util_client.getCachePath();
    let createFile = await DMC_Upload.util_client.createFile(fileSize);
    let add_file = await stack_upload.trans().publish_file({
        common: {
            req_path: "qaTest",
            // 来源DEC
            // api级别
            dec_id,
            level: cyfs.NDNAPILevel.NDN,
            target: stack_upload.local_device_id().object_id,
            // targrt设备参数
            // 需要处理数据的关联对象，主要用以chunk/file等
            referer_object: [],
            flags: 1,
        },
        owner: stack_upload.local_device_id().object_id,
        local_path: createFile.filePath,
        chunk_size: 4 * 1024 * 1024
    });
    let test_file = add_file.unwrap().file_id;
    let task_id;
    await cyfs.sleep(1000);
    const req1 = {
        object_id: test_file,
        common: {
            req_path: "qaTest",
            level: cyfs.NONAPILevel.NON,
            target: stack_upload.local_device_id().object_id,
            dec_id,
            flags: 0,
        }
    };
    const get_ret = await stack_upload.non_service().get_object(req1);
    let file_obj = get_ret.unwrap().object;
    let stream = await stack_upload.non_service().put_object({
        common: {
            dec_id,
            flags: 0,
            target: stack_download.local_device_id().object_id,
            level: cyfs.NONAPILevel.Router //设置路由类型
        },
        object: new cyfs.NONObjectInfo(test_file, file_obj.object_raw)
    });
    _interface.getLogger().info(`##### ${JSON.stringify(stream.unwrap().result)}`);
    await cyfs.sleep(1000);
    _interface.getLogger().info("获取task object");
    const req2 = {
        object_id: test_file,
        common: {
            req_path: "qaTest",
            level: cyfs.NONAPILevel.Router,
            target: stack_upload.local_device_id().object_id,
            dec_id,
            flags: 0,
        }
    };
    const get_ret2 = await stack_download.non_service().get_object(req2);
    get_ret2.unwrap().object;
    let save_filePath = path.join(download_path.cache_path.file_download, createFile.fileName);
    _interface.getLogger().info(`${JSON.stringify(get_ret2)}`);
    let begin = Date.now();
    let download = await stack_download.trans().create_task({
        common: {
            req_path: "qaTest",
            dec_id,
            level: cyfs.NDNAPILevel.Router,
            target: stack_download.local_device_id().object_id,
            referer_object: [new cyfs.NDNDataRefererObject(test_file)],
            flags: 1,
        },
        object_id: test_file,
        local_path: save_filePath,
        device_list: [stack_upload.local_device_id()],
        auto_start: true,
    });
    _interface.getLogger().info(`##${download}`);
    let download_id = download.unwrap().task_id;
    let savePath = path.join(__dirname, "../../DMC_download.txt");
    if (!fs.pathExistsSync(savePath)) {
        fs.createFileSync(savePath);
    }
    for (let i = 0; i < timeout; i++) {
        let task = await stack_download.trans().get_task_state({
            common: {
                req_path: "qaTest",
                dec_id,
                level: cyfs.NDNAPILevel.Router,
                referer_object: [],
                flags: 1,
            },
            task_id: download_id
        });
        _interface.getLogger().info(`####### 传输状态： ${JSON.stringify(task.unwrap())}`);
        let file = fs.appendFileSync(savePath, ` ${JSON.stringify(task.unwrap())}\n`);
        let state = task.unwrap().state;
        if (state == 4) {
            _interface.getLogger().info(`####### 传输完成： ${JSON.stringify(task.unwrap())} ,time = ${Date.now() - begin} ,文件大小 : ${fileSize}`);
            return { err: base_1.ErrorCode.succ, fileId: test_file.to_base_58(), time: Date.now() - begin, fileSize };
        }
        if (state == 5) {
            _interface.getLogger().info(`####### 传输完成： ${JSON.stringify(task.unwrap())} ,time = ${Date.now() - begin} ,文件大小 : ${fileSize}`);
            return { err: base_1.ErrorCode.exception, fileId: test_file.to_base_58(), time: Date.now() - begin, fileSize };
        }
        await cyfs.sleep(1000);
    }
    return { err: base_1.ErrorCode.timeout, fileId: test_file.to_base_58(), time: Date.now() - begin, fileSize };
}
async function TaskMain(_interface) {
    let dec_id = cyfs.ObjectId.from_base_58("9tGpLNnab9uVtjeaK4bM59QKSkLEGWow1pJq6hjjK9MM").unwrap();
    let DMC_Download = new stackTool_1.StackProxyClient({
        _interface,
        peerName: "DMC_Download",
        stack_type: "ood",
        timeout: 60 * 1000,
        ws_port: 20001,
        http_port: 20002
    });
    await DMC_Download.init();
    let DMC_Upload = new stackTool_1.StackProxyClient({
        _interface,
        peerName: "DMC_Upload",
        stack_type: "ood",
        timeout: 60 * 1000,
        ws_port: 20003,
        http_port: 20004
    });
    await DMC_Upload.init();
    _interface.getLogger().info(`Waiting for proxy to connection...`);
    let stack_download = cyfs.SharedCyfsStack.open(cyfs.SharedCyfsStackParam.new_with_ws_event_ports(20002, 20001, dec_id).unwrap());
    let resp = await stack_download.wait_online(cyfs.None);
    _interface.getLogger().info(`wait_online finished ${JSON.stringify(resp.unwrap())}`);
    let res = await stack_download.util().get_zone({ common: { flags: 0 } });
    let stack_upload = cyfs.SharedCyfsStack.open(cyfs.SharedCyfsStackParam.new_with_ws_event_ports(20004, 20003, dec_id).unwrap());
    let resp2 = await stack_upload.wait_online(cyfs.None);
    _interface.getLogger().info(`wait_online finished ${JSON.stringify(resp.unwrap())}`);
    let res2 = await stack_upload.util().get_zone({ common: { flags: 0 } });
    let result = await test_file(_interface, DMC_Download, DMC_Upload, stack_download, stack_upload, 50 * 1024 * 1024, 500);
    let savePath = path.join(__dirname, "../../DMC.txt");
    if (!fs.pathExistsSync(savePath)) {
        fs.createFileSync(savePath);
    }
    let file = fs.appendFileSync(savePath, `${JSON.stringify(result)}\n`);
    await _interface.exit(base_1.ClientExitCode.failed, `${result}`);
}
exports.TaskMain = TaskMain;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ub2RlLXRlc3Rlci1hcHAvdGFza3MvRE1DX2RlYnVnZXJfNTBNQi9vbmxvYWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHFDQUFxSztBQUNySywyQ0FBNEI7QUFDNUIsMkVBQThFO0FBQzlFLGtGQUFtRTtBQUNuRSw2Q0FBK0I7QUFHL0IsS0FBSyxVQUFVLFNBQVMsQ0FBQyxVQUErQixFQUFDLFlBQTZCLEVBQUMsVUFBMkIsRUFBQyxjQUFtQyxFQUFDLFlBQWlDLEVBQUMsUUFBZSxFQUFDLE9BQWM7SUFDbk4sSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsOENBQThDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNqRyxJQUFJLGFBQWEsR0FBRyxNQUFNLFlBQVksQ0FBQyxXQUFZLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDbkUsSUFBSSxVQUFVLEdBQUcsTUFBTSxVQUFVLENBQUMsV0FBWSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNwRSxJQUFJLFFBQVEsR0FBRyxNQUFNLFlBQVksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxZQUFZLENBQUM7UUFDbkQsTUFBTSxFQUFFO1lBQ0osUUFBUSxFQUFFLFFBQVE7WUFDbEIsUUFBUTtZQUNSLFFBQVE7WUFDUixNQUFNO1lBQ04sS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRztZQUMzQixNQUFNLEVBQUcsWUFBWSxDQUFDLGVBQWUsRUFBRSxDQUFDLFNBQVM7WUFDakQsYUFBYTtZQUNiLDhCQUE4QjtZQUM5QixjQUFjLEVBQUUsRUFBRTtZQUNsQixLQUFLLEVBQUUsQ0FBQztTQUNYO1FBQ0QsS0FBSyxFQUFFLFlBQVksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxTQUFTO1FBQy9DLFVBQVUsRUFBRSxVQUFVLENBQUMsUUFBUztRQUNoQyxVQUFVLEVBQUUsQ0FBQyxHQUFHLElBQUksR0FB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Q0FBQyxRQUFRLENBQUMsRUFBQztRQUM1QixFQUFFLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0tBQzlCO0lBQ0QsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNwRSxNQUFNLFVBQVUsQ0FBQyxJQUFJLENBQUMscUJBQWMsQ0FBQyxNQUFNLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQyxDQUFBO0FBQzdELENBQUM7QUF0Q0QsNEJBc0NDIiwiZmlsZSI6InRhc2tzL0RNQ19kZWJ1Z2VyXzUwTUIvb25sb2FkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXJyb3JDb2RlLCBOZXRFbnRyeSwgTmFtZXNwYWNlLCBBY2Nlc3NOZXRUeXBlLCBCdWZmZXJSZWFkZXIsIExvZ2dlciwgVGFza0NsaWVudEludGVyZmFjZSwgQ2xpZW50RXhpdENvZGUsIEJ1ZmZlcldyaXRlciwgUmFuZG9tR2VuZXJhdG9yIH0gZnJvbSAnLi4vLi4vYmFzZSc7XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIlxyXG5pbXBvcnQgeyBTdGFja1Byb3h5Q2xpZW50IH0gZnJvbSBcIi4uLy4uL3Rhc2tUb29scy9jeWZzX3N0YWNrX3R1bm5lbC9zdGFja1Rvb2xcIlxyXG5pbXBvcnQgKiBhcyBjeWZzIGZyb20gXCIuLi8uLi90YXNrVG9vbHMvY3lmc19zdGFja190dW5uZWwvY3lmc19ub2RlXCJcclxuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzLWV4dHJhXCI7IFxyXG5cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHRlc3RfZmlsZShfaW50ZXJmYWNlOiBUYXNrQ2xpZW50SW50ZXJmYWNlLERNQ19Eb3dubG9hZDpTdGFja1Byb3h5Q2xpZW50LERNQ19VcGxvYWQ6U3RhY2tQcm94eUNsaWVudCxzdGFja19kb3dubG9hZDpjeWZzLlNoYXJlZEN5ZnNTdGFjayxzdGFja191cGxvYWQ6Y3lmcy5TaGFyZWRDeWZzU3RhY2ssZmlsZVNpemU6bnVtYmVyLHRpbWVvdXQ6bnVtYmVyKSB7XHJcbiAgICBsZXQgZGVjX2lkID0gY3lmcy5PYmplY3RJZC5mcm9tX2Jhc2VfNTgoXCI5dEdwTE5uYWI5dVZ0amVhSzRiTTU5UUtTa0xFR1dvdzFwSnE2aGpqSzlNTVwiKS51bndyYXAoKTtcclxuICAgIGxldCBkb3dubG9hZF9wYXRoID0gYXdhaXQgRE1DX0Rvd25sb2FkLnV0aWxfY2xpZW50IS5nZXRDYWNoZVBhdGgoKTtcclxuICAgIGxldCBjcmVhdGVGaWxlID0gYXdhaXQgRE1DX1VwbG9hZC51dGlsX2NsaWVudCEuY3JlYXRlRmlsZShmaWxlU2l6ZSk7XHJcbiAgICBsZXQgYWRkX2ZpbGUgPSBhd2FpdCBzdGFja191cGxvYWQudHJhbnMoKS5wdWJsaXNoX2ZpbGUoe1xyXG4gICAgICAgIGNvbW1vbjogey8vIOivt+axgui3r+W+hO+8jOWPr+S4uuepulxyXG4gICAgICAgICAgICByZXFfcGF0aDogXCJxYVRlc3RcIixcclxuICAgICAgICAgICAgLy8g5p2l5rqQREVDXHJcbiAgICAgICAgICAgIC8vIGFwaee6p+WIq1xyXG4gICAgICAgICAgICBkZWNfaWQsXHJcbiAgICAgICAgICAgIGxldmVsOiBjeWZzLk5ETkFQSUxldmVsLk5ETixcclxuICAgICAgICAgICAgdGFyZ2V0IDogc3RhY2tfdXBsb2FkLmxvY2FsX2RldmljZV9pZCgpLm9iamVjdF9pZCxcclxuICAgICAgICAgICAgLy8gdGFyZ3J06K6+5aSH5Y+C5pWwXHJcbiAgICAgICAgICAgIC8vIOmcgOimgeWkhOeQhuaVsOaNrueahOWFs+iBlOWvueixoe+8jOS4u+imgeeUqOS7pWNodW5rL2ZpbGXnrYlcclxuICAgICAgICAgICAgcmVmZXJlcl9vYmplY3Q6IFtdLFxyXG4gICAgICAgICAgICBmbGFnczogMSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG93bmVyOiBzdGFja191cGxvYWQubG9jYWxfZGV2aWNlX2lkKCkub2JqZWN0X2lkLFxyXG4gICAgICAgIGxvY2FsX3BhdGg6IGNyZWF0ZUZpbGUuZmlsZVBhdGghLFxyXG4gICAgICAgIGNodW5rX3NpemU6IDQgKiAxMDI0ICogMTAyNFxyXG4gICAgfSk7XHJcbiAgIFxyXG4gICAgbGV0IHRlc3RfZmlsZSA9IGFkZF9maWxlLnVud3JhcCgpLmZpbGVfaWRcclxuICAgIGxldCB0YXNrX2lkOiBzdHJpbmc7XHJcbiAgICBhd2FpdCBjeWZzLnNsZWVwKDEwMDApXHJcblxyXG4gICAgY29uc3QgcmVxMTogY3lmcy5OT05HZXRPYmplY3RPdXRwdXRSZXF1ZXN0ID0ge1xyXG4gICAgICAgIG9iamVjdF9pZDogdGVzdF9maWxlLFxyXG4gICAgICAgIGNvbW1vbjoge1xyXG4gICAgICAgICAgICByZXFfcGF0aDogXCJxYVRlc3RcIixcclxuICAgICAgICAgICAgbGV2ZWw6IGN5ZnMuTk9OQVBJTGV2ZWwuTk9OLFxyXG4gICAgICAgICAgICB0YXJnZXQ6IHN0YWNrX3VwbG9hZC5sb2NhbF9kZXZpY2VfaWQoKS5vYmplY3RfaWQsXHJcbiAgICAgICAgICAgIGRlY19pZCxcclxuICAgICAgICAgICAgZmxhZ3M6IDAsXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNvbnN0IGdldF9yZXQgPSBhd2FpdCBzdGFja191cGxvYWQubm9uX3NlcnZpY2UoKS5nZXRfb2JqZWN0KHJlcTEpO1xyXG4gICAgbGV0IGZpbGVfb2JqID0gZ2V0X3JldC51bndyYXAoKS5vYmplY3Q7XHJcbiAgICBsZXQgc3RyZWFtID0gYXdhaXQgc3RhY2tfdXBsb2FkLm5vbl9zZXJ2aWNlKCkucHV0X29iamVjdCh7XHJcbiAgICAgICAgY29tbW9uOiB7XHJcbiAgICAgICAgICAgIGRlY19pZCxcclxuICAgICAgICAgICAgZmxhZ3M6IDAsXHJcbiAgICAgICAgICAgIHRhcmdldDogc3RhY2tfZG93bmxvYWQubG9jYWxfZGV2aWNlX2lkKCkub2JqZWN0X2lkLFxyXG4gICAgICAgICAgICBsZXZlbDogY3lmcy5OT05BUElMZXZlbC5Sb3V0ZXIgLy/orr7nva7ot6/nlLHnsbvlnotcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9iamVjdDogbmV3IGN5ZnMuTk9OT2JqZWN0SW5mbyh0ZXN0X2ZpbGUsIGZpbGVfb2JqLm9iamVjdF9yYXcpXHJcbiAgICB9KVxyXG4gICAgX2ludGVyZmFjZS5nZXRMb2dnZXIoKS5pbmZvKGAjIyMjIyAke0pTT04uc3RyaW5naWZ5KHN0cmVhbS51bndyYXAoKS5yZXN1bHQpIH1gKVxyXG4gICAgYXdhaXQgY3lmcy5zbGVlcCgxMDAwKVxyXG4gICAgX2ludGVyZmFjZS5nZXRMb2dnZXIoKS5pbmZvKFwi6I635Y+WdGFzayBvYmplY3RcIik7XHJcbiAgICBjb25zdCByZXEyOiBjeWZzLk5PTkdldE9iamVjdE91dHB1dFJlcXVlc3QgPSB7XHJcbiAgICAgICAgb2JqZWN0X2lkOnRlc3RfZmlsZSxcclxuICAgICAgICBjb21tb246IHtcclxuICAgICAgICAgICAgcmVxX3BhdGg6IFwicWFUZXN0XCIsXHJcbiAgICAgICAgICAgIGxldmVsOiBjeWZzLk5PTkFQSUxldmVsLlJvdXRlcixcclxuICAgICAgICAgICAgdGFyZ2V0IDpzdGFja191cGxvYWQubG9jYWxfZGV2aWNlX2lkKCkub2JqZWN0X2lkLFxyXG4gICAgICAgICAgICBkZWNfaWQsXHJcbiAgICAgICAgICAgIGZsYWdzOiAwLFxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBjb25zdCBnZXRfcmV0MiA9IGF3YWl0IHN0YWNrX2Rvd25sb2FkLm5vbl9zZXJ2aWNlKCkuZ2V0X29iamVjdChyZXEyKTtcclxuICAgIGdldF9yZXQyLnVud3JhcCgpLm9iamVjdFxyXG4gICAgbGV0IHNhdmVfZmlsZVBhdGggPSAgcGF0aC5qb2luKCBkb3dubG9hZF9wYXRoLmNhY2hlX3BhdGghLmZpbGVfZG93bmxvYWQhLGNyZWF0ZUZpbGUuZmlsZU5hbWUhKVxyXG4gICAgX2ludGVyZmFjZS5nZXRMb2dnZXIoKS5pbmZvKGAke0pTT04uc3RyaW5naWZ5KGdldF9yZXQyKSB9YClcclxuICAgIGxldCBiZWdpbiA9IERhdGUubm93KCk7XHJcbiAgICBsZXQgZG93bmxvYWQgPSBhd2FpdCBzdGFja19kb3dubG9hZC50cmFucygpLmNyZWF0ZV90YXNrKCB7XHJcbiAgICAgICAgY29tbW9uOiAge1xyXG4gICAgICAgICAgICByZXFfcGF0aDogXCJxYVRlc3RcIixcclxuICAgICAgICAgICAgZGVjX2lkLFxyXG4gICAgICAgICAgICBsZXZlbDogY3lmcy5ORE5BUElMZXZlbC5Sb3V0ZXIsXHJcbiAgICAgICAgICAgIHRhcmdldCA6IHN0YWNrX2Rvd25sb2FkLmxvY2FsX2RldmljZV9pZCgpLm9iamVjdF9pZCxcclxuICAgICAgICAgICAgcmVmZXJlcl9vYmplY3Q6IFtuZXcgY3lmcy5ORE5EYXRhUmVmZXJlck9iamVjdCh0ZXN0X2ZpbGUpXSxcclxuICAgICAgICAgICAgZmxhZ3M6IDEsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBvYmplY3RfaWQ6IHRlc3RfZmlsZSxcclxuICAgICAgICBsb2NhbF9wYXRoOiBzYXZlX2ZpbGVQYXRoLFxyXG4gICAgICAgIGRldmljZV9saXN0OiBbc3RhY2tfdXBsb2FkLmxvY2FsX2RldmljZV9pZCgpXSxcclxuICAgICAgICBhdXRvX3N0YXJ0OiB0cnVlLFxyXG4gICAgfSlcclxuICAgIF9pbnRlcmZhY2UuZ2V0TG9nZ2VyKCkuaW5mbyhgIyMke2Rvd25sb2FkfWApXHJcbiAgICBcclxuICAgIGxldCBkb3dubG9hZF9pZCAgPSBkb3dubG9hZC51bndyYXAoKS50YXNrX2lkXHJcbiAgICBsZXQgc2F2ZVBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLFwiLi4vLi4vRE1DX2Rvd25sb2FkLnR4dFwiKVxyXG4gICAgaWYoIWZzLnBhdGhFeGlzdHNTeW5jKHNhdmVQYXRoKSl7XHJcbiAgICAgICAgZnMuY3JlYXRlRmlsZVN5bmMoc2F2ZVBhdGgpXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZvcihsZXQgaSA9MDtpPHRpbWVvdXQ7aSsrKXtcclxuICAgICAgICBsZXQgdGFzayA9IGF3YWl0IHN0YWNrX2Rvd25sb2FkLnRyYW5zKCkuZ2V0X3Rhc2tfc3RhdGUoIHtcclxuICAgICAgICAgICAgY29tbW9uOiAge1xyXG4gICAgICAgICAgICAgICAgcmVxX3BhdGg6IFwicWFUZXN0XCIsXHJcbiAgICAgICAgICAgICAgICBkZWNfaWQsXHJcbiAgICAgICAgICAgICAgICBsZXZlbDogY3lmcy5ORE5BUElMZXZlbC5Sb3V0ZXIsXHJcbiAgICAgICAgICAgICAgICByZWZlcmVyX29iamVjdDogW10sXHJcbiAgICAgICAgICAgICAgICBmbGFnczogMSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGFza19pZCA6IGRvd25sb2FkX2lkXHJcbiAgICAgICAgfSlcclxuICAgICAgICBfaW50ZXJmYWNlLmdldExvZ2dlcigpLmluZm8oYCMjIyMjIyMg5Lyg6L6T54q25oCB77yaICR7SlNPTi5zdHJpbmdpZnkodGFzay51bndyYXAoKSl9YCApO1xyXG4gICAgICAgIGxldCBmaWxlID0gZnMuYXBwZW5kRmlsZVN5bmMoc2F2ZVBhdGgsYCAke0pTT04uc3RyaW5naWZ5KHRhc2sudW53cmFwKCkpfVxcbmApXHJcbiAgICAgICAgbGV0IHN0YXRlID0gdGFzay51bndyYXAoKS5zdGF0ZTtcclxuICAgICAgICBpZihzdGF0ZT09NCl7XHJcbiAgICAgICAgICAgIF9pbnRlcmZhY2UuZ2V0TG9nZ2VyKCkuaW5mbyhgIyMjIyMjIyDkvKDovpPlrozmiJDvvJogJHtKU09OLnN0cmluZ2lmeSh0YXNrLnVud3JhcCgpKX0gLHRpbWUgPSAke0RhdGUubm93KCkgLSBiZWdpbn0gLOaWh+S7tuWkp+WwjyA6ICR7ZmlsZVNpemV9YCApO1xyXG4gICAgICAgICAgICByZXR1cm4ge2VycjpFcnJvckNvZGUuc3VjYyxmaWxlSWQ6dGVzdF9maWxlLnRvX2Jhc2VfNTgoKSx0aW1lOkRhdGUubm93KCkgLSBiZWdpbixmaWxlU2l6ZX1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoc3RhdGU9PTUpe1xyXG4gICAgICAgICAgICBfaW50ZXJmYWNlLmdldExvZ2dlcigpLmluZm8oYCMjIyMjIyMg5Lyg6L6T5a6M5oiQ77yaICR7SlNPTi5zdHJpbmdpZnkodGFzay51bndyYXAoKSl9ICx0aW1lID0gJHtEYXRlLm5vdygpIC0gYmVnaW59ICzmlofku7blpKflsI8gOiAke2ZpbGVTaXplfWAgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHtlcnI6RXJyb3JDb2RlLmV4Y2VwdGlvbixmaWxlSWQ6dGVzdF9maWxlLnRvX2Jhc2VfNTgoKSx0aW1lOkRhdGUubm93KCkgLSBiZWdpbixmaWxlU2l6ZX1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGF3YWl0IGN5ZnMuc2xlZXAoMTAwMClcclxuICAgIH1cclxuICAgIHJldHVybiB7ZXJyOkVycm9yQ29kZS50aW1lb3V0LGZpbGVJZDp0ZXN0X2ZpbGUudG9fYmFzZV81OCgpLHRpbWU6RGF0ZS5ub3coKSAtIGJlZ2luLGZpbGVTaXplfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gVGFza01haW4oX2ludGVyZmFjZTogVGFza0NsaWVudEludGVyZmFjZSkge1xyXG5cclxuICAgIGxldCBkZWNfaWQgPSBjeWZzLk9iamVjdElkLmZyb21fYmFzZV81OChcIjl0R3BMTm5hYjl1VnRqZWFLNGJNNTlRS1NrTEVHV293MXBKcTZoampLOU1NXCIpLnVud3JhcCgpO1xyXG4gICAgbGV0IERNQ19Eb3dubG9hZCA9IG5ldyBTdGFja1Byb3h5Q2xpZW50KHtcclxuICAgICAgICBfaW50ZXJmYWNlLFxyXG4gICAgICAgIHBlZXJOYW1lOiBcIkRNQ19Eb3dubG9hZFwiLFxyXG4gICAgICAgIHN0YWNrX3R5cGU6IFwib29kXCIsXHJcbiAgICAgICAgdGltZW91dDogNjAgKiAxMDAwLFxyXG4gICAgICAgIHdzX3BvcnQ6IDIwMDAxLFxyXG4gICAgICAgIGh0dHBfcG9ydDogMjAwMDJcclxuICAgIH0pXHJcbiAgICBhd2FpdCBETUNfRG93bmxvYWQuaW5pdCgpO1xyXG4gICAgbGV0IERNQ19VcGxvYWQgPSBuZXcgU3RhY2tQcm94eUNsaWVudCh7XHJcbiAgICAgICAgX2ludGVyZmFjZSxcclxuICAgICAgICBwZWVyTmFtZTogXCJETUNfVXBsb2FkXCIsXHJcbiAgICAgICAgc3RhY2tfdHlwZTogXCJvb2RcIixcclxuICAgICAgICB0aW1lb3V0OiA2MCAqIDEwMDAsXHJcbiAgICAgICAgd3NfcG9ydDogMjAwMDMsXHJcbiAgICAgICAgaHR0cF9wb3J0OiAyMDAwNFxyXG4gICAgfSlcclxuICAgIGF3YWl0IERNQ19VcGxvYWQuaW5pdCgpO1xyXG4gICAgXHJcbiAgICBfaW50ZXJmYWNlLmdldExvZ2dlcigpLmluZm8oYFdhaXRpbmcgZm9yIHByb3h5IHRvIGNvbm5lY3Rpb24uLi5gKTtcclxuICAgIGxldCBzdGFja19kb3dubG9hZCA9IGN5ZnMuU2hhcmVkQ3lmc1N0YWNrLm9wZW4oY3lmcy5TaGFyZWRDeWZzU3RhY2tQYXJhbS5uZXdfd2l0aF93c19ldmVudF9wb3J0cygyMDAwMiwgMjAwMDEsZGVjX2lkKS51bndyYXAoKSlcclxuICAgIGxldCByZXNwID0gYXdhaXQgc3RhY2tfZG93bmxvYWQud2FpdF9vbmxpbmUoY3lmcy5Ob25lKTtcclxuICAgIF9pbnRlcmZhY2UuZ2V0TG9nZ2VyKCkuaW5mbyhgd2FpdF9vbmxpbmUgZmluaXNoZWQgJHtKU09OLnN0cmluZ2lmeShyZXNwLnVud3JhcCgpKX1gKTtcclxuICAgIGxldCByZXMgPSBhd2FpdCBzdGFja19kb3dubG9hZC51dGlsKCkuZ2V0X3pvbmUoeyBjb21tb246IHsgZmxhZ3M6IDAgfSB9KTtcclxuICAgIGxldCBzdGFja191cGxvYWQgPSBjeWZzLlNoYXJlZEN5ZnNTdGFjay5vcGVuKGN5ZnMuU2hhcmVkQ3lmc1N0YWNrUGFyYW0ubmV3X3dpdGhfd3NfZXZlbnRfcG9ydHMoMjAwMDQsIDIwMDAzLGRlY19pZCkudW53cmFwKCkpXHJcbiAgICBsZXQgcmVzcDIgPSBhd2FpdCBzdGFja191cGxvYWQud2FpdF9vbmxpbmUoY3lmcy5Ob25lKTtcclxuICAgIF9pbnRlcmZhY2UuZ2V0TG9nZ2VyKCkuaW5mbyhgd2FpdF9vbmxpbmUgZmluaXNoZWQgJHtKU09OLnN0cmluZ2lmeShyZXNwLnVud3JhcCgpKX1gKTtcclxuICAgIGxldCByZXMyID0gYXdhaXQgc3RhY2tfdXBsb2FkLnV0aWwoKS5nZXRfem9uZSh7IGNvbW1vbjogeyBmbGFnczogMCB9IH0pO1xyXG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0IHRlc3RfZmlsZShfaW50ZXJmYWNlLERNQ19Eb3dubG9hZCxETUNfVXBsb2FkLHN0YWNrX2Rvd25sb2FkLHN0YWNrX3VwbG9hZCw1MCoxMDI0KjEwMjQsMjAwKTtcclxuICAgIGxldCBzYXZlUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsXCIuLi8uLi9ETUMudHh0XCIpXHJcbiAgICBpZighZnMucGF0aEV4aXN0c1N5bmMoc2F2ZVBhdGgpKXtcclxuICAgICAgICBmcy5jcmVhdGVGaWxlU3luYyhzYXZlUGF0aClcclxuICAgIH1cclxuICAgIGxldCBmaWxlID0gZnMuYXBwZW5kRmlsZVN5bmMoc2F2ZVBhdGgsYCR7SlNPTi5zdHJpbmdpZnkocmVzdWx0KX1cXG5gKVxyXG4gICAgYXdhaXQgX2ludGVyZmFjZS5leGl0KENsaWVudEV4aXRDb2RlLmZhaWxlZCwgYCR7cmVzdWx0fWApXHJcbn1cclxuIl19
